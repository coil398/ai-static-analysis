# create-skill

新しいスキルを作成するためのメタスキル。スキル定義・実装雛形・テスト雛形の生成と、SPEC.mdとの整合性チェックを包括的に行う。

---

## スキルとは

このプロジェクトにおける「スキル」は2つのレイヤーで構成される：

1. **スキル定義** (`.claude/skills/<name>.md`) — Claude への指示書。何をするか・どう実行するかを自然言語で記述。
2. **実装コード** — スキル定義が参照する実際のコード。配置先はスキルの性質による。

スキル定義だけで完結するもの（メタスキル）と、実装コードを伴うものがある。

---

## スキル作成プロセス

新しいスキルを作るときは、以下の Step 1〜5 を順に実行する。

### Step 1: 要件整理

以下を明確にしてからスキル定義に着手する。

- **目的**: スキルが解決する課題を1行で定義
- **SPEC.md参照**: 該当セクション番号を特定（該当なしなら「なし」と明記）
- **入力/出力**: 何を受け取り何を返すか
- **依存**: 他のスキル・コンポーネントへの依存関係
- **スコープ**: コア機能か、言語別か、メタかを判断（→ 配置先が決まる）

### Step 2: スキル定義ファイルの作成

`.claude/skills/<name>.md` を「スキル定義テンプレート」に従って作成する。

### Step 3: 実装雛形の作成

スキルが実装コードを伴う場合、「ディレクトリ配置規約」に従って雛形を生成する。

実装雛形に含めるもの：
- ディレクトリ構造
- エントリポイントファイル（最低限のインターフェース定義）
- README（スキル固有の使い方があれば）

実装言語はスキルごとに自由に選択できる。ただし選択理由をスキル定義に記載すること。

### Step 4: SPEC.md 整合性チェック

「SPEC.md 整合性チェックリスト」を実行する。
問題があれば修正し、SPEC.md に記載のない新規スキルの場合は SPEC.md への追記要否を判断する。

### Step 5: テスト雛形の作成

テスト方針を定義し、テストファイルの雛形を作成する。

テスト雛形に含めるもの：
- テストディレクトリ（実装と同階層 or `tests/` 配下）
- テストケースの枠組み（正常系・異常系・境界値の最低限のケース名）
- テスト実行方法の記載

---

## スキル定義テンプレート

新しいスキルの `.claude/skills/<name>.md` は以下の構造に従う。

```markdown
# <name>

<1行での目的説明>

---

## 概要

<スキルが何をするか、なぜ必要かを2-3文で>

## SPEC.md 参照

- セクション: <該当セクション番号と名前。なければ「該当なし」>
- 関連要件: <MUST/SHOULD 要件の引用>

## 入力

- `<param>`: <型と説明>

## 出力

- <出力の形式と内容>

## 依存

- <他のスキル/コンポーネント名とその役割>
- なし（依存がない場合）

## 実装

### 配置先

<このスキルの実装コードが置かれるパス>

### 実装言語

<選択した言語と理由>

### 処理フロー

1. <ステップ>
2. <ステップ>
3. ...

### エラーハンドリング

<失敗時の挙動。SPEC.md §7.1 の degrade 方針に準拠>

## テスト方針

- <テスト対象と手法>

## 使用例

<具体的な使用シナリオをコード例付きで>
```

---

## ディレクトリ配置規約

スキルの性質に応じて、実装コードの配置先を決定する。

| スキルの性質 | 配置先 | 例 |
|---|---|---|
| コア機能 | `core/<module>/` | fingerprint, schema, storage |
| 言語別解析 | `adapters/<lang>/` | Go adapter, TS adapter |
| AI 操作単位 | `skills/<name>/` | index, update, query |
| メタ（開発支援） | `.claude/skills/` のみ | create-skill |

### 実装雛形の構成

```
<配置先>/
├── README.md          # （任意）スキル固有の詳細説明
├── <entrypoint>       # エントリポイント（言語に依存）
├── <module files>     # 内部モジュール
└── tests/             # テスト（同階層に置く場合）
    └── <test files>
```

---

## SPEC.md 整合性チェックリスト

新しいスキルを作成したら、以下をすべて確認する。

- [ ] **§2 ディレクトリ構成**: 配置先が SPEC.md のディレクトリ構成と矛盾しないか
- [ ] **§3 分離原則**: コア/アダプタ/スキルの責務分離に従っているか
- [ ] **§4 Fingerprint**: fingerprint に影響する場合、生成・比較・wipe ルールに対応しているか
- [ ] **§5-6 Facts スキーマ**: facts を読み書きする場合、P0 データモデルに準拠しているか
- [ ] **§7 大規模対応**: MUST 要件（差分更新、degrade、generated 扱い）に違反しないか
- [ ] **§8 アダプタ契約**: アダプタに関わる場合、LanguageAdapter/ActionAdapter インターフェースが一致するか
- [ ] **§12 MVP 順序**: 依存先が未実装の場合、その旨を明記しているか
- [ ] **§13 禁止事項**: cache の Git 管理や AI 推測による facts 生成を行っていないか

---

## 命名規約

| 対象 | 規約 | 例 |
|---|---|---|
| スキル定義ファイル | `kebab-case.md` | `create-skill.md`, `index-facts.md` |
| スキル名 | 動詞 + 名詞 | `index-facts`, `query-deps`, `run-check` |
| 実装ディレクトリ | 実装言語の慣例に従う | `snake_case`(Python), `camelCase`(TS) |
| テストファイル | 実装言語の慣例に従う | `*_test.go`, `*.test.ts`, `test_*.py` |

---

## 注意事項

- スキル定義は「指示書」であり、実装コードではない。Claude が読んで作業手順を理解できることが最優先。
- 実装言語はスキルごとに自由に選択できる。ただしプロジェクト内での一貫性も考慮する。
- `cache/` に生成物を置く場合は必ず `.gitignore` に追加する。
- AI の推測で facts を生成する指示を書いてはいけない（SPEC.md §13）。
- スキル作成時に SPEC.md の不備・不足を発見した場合は、SPEC.md の更新も合わせて提案する。
